<!DOCTYPE html>
<html>
    <head>
        <title>Sources</title>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

    </head>
    <body>
        <h1>Sources and Keywords</h1>
        <div><button id="button-showAddSource" onclick="showAddSource()">Add News Source</button><br/><br/></div>
        <div>
            <table border="1" id="sourceTable">
                <tr>
                        <th>id</th>
                        <th>Source</th>
                        <th>Keyword</th>
                        <th>Update</th>
                        <th>Delete</th>
                </tr>  
            
            </table>
        <br/>
        </div>
        <div>
            <form id="createUpdateForm" style="display:none">
                <h2><span id="createLabel">Create a</span> <span id="updateLabel">Update this</span> Source</h2>
                Source <input type="text" name="source"><br/>
                Keyword <input type="text" name="keyword"><br/>
            
                <span><button type="submit" id="button-doAddSource">Create</button></span>
                <span><button id="button-doUpdateSource">Update</button></span>

            </form>
        </div>
    </body>
    <script>
        //Using fetch to populate table with MySQL database table content
        // https://dev.to/duhbhavesh/how-to-use-fetch-api-for-crud-operations-57a0
        fetch('/sourcesjson')
        .then(response => response.json())
        .then(data => {
            // Loop through the data and add a row for each item
            data.forEach(item => {
            let row = document.createElement('tr');
            row.innerHTML = `
            <td>${item.id}</td>
            <td>${item.source}</td>
            <td>${item.keyword}</td>
            <td><button class="update-button" data-id="${item.id}">Update</button></td>
            <td><button class="delete-button" data-id="${item.id}" onclick="deleteSource(event)">Delete</button></td>`;
            document.querySelector('#sourceTable').appendChild(row);
            });
        });

        function showAddSource(){
            document.getElementById("createUpdateForm").style.display = "block"  
            document.getElementById("button-doAddSource").style.display = "block"
            document.getElementById("button-doUpdateSource").style.display = "none"
            document.getElementById("createLabel").style.display = "inline"
            document.getElementById("updateLabel").style.display = "none"
            document.getElementById("button-showAddSource").style.display = "none"
            document.getElementById("sourceTable").style.display = "none"  
        }

        // Adding sources input by the user to the table
        var createUpdateForm = document.getElementById('createUpdateForm');
        createUpdateForm.addEventListener('submit', function(event) {
        // Use the fetch API to send the form data to the server
            fetch('/sources', {
                method: 'POST',
                body: new FormData(createUpdateForm)
            })
            .then(response => response.text())
            .then(text => console.log(text))
        });

        // Deleting source from the table
        function deleteSource(event) {
            console.log('Delete button clicked');
            // Get the id of the row to be deleted
            var id = event.target.getAttribute('data-id');
            fetch('/sources/' + id, {
                method: 'DELETE'
            })
            .then(response => response.text())
            .then(text => {
                console.log(text);
                location.reload();})
        }

    </script>
</html>